package com.quantang.dao.impl;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.dao.DataAccessException;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

import com.quantang.common.Constant;
import com.quantang.dao.CaptureDao;

@Repository
public class CaptureDaoImpl implements CaptureDao {
	@Autowired
	private JdbcTemplate jdbcTemplate;

	@Override
	public void saveNobleMetalData(String datas) {
		// TODO Auto-generated method stub
		if ("".equals(datas) || datas == null) {
			return;
		}
		String data[] = datas.split(";");
		for (int i = 0; i < data.length; i++) {
//			metalClass(data[i], i);
			String[] datainfo = data[i].split("\"")[1].split(",");
			if (data[i].contains(Constant.CAPTURE_CALSS[i])) {
				Constant.TMP_TRADEDATE[i] = datainfo[6];
				if (!"".equals(Constant.TMP_TRADEDATE[i]) && datainfo[6].equals(Constant.TMP_TRADEDATE[i])) {
					break;
				}
				saveData(Constant.CAPTURE_CALSS[i], datainfo);
				break;
			}
		}
	}

/*	private void metalClass(String data, int i) {

		String[] datainfo = data.split("\"")[1].split(",");
		 for (int i = 0; i < Constant.CAPTURE_CALSS.length; i++) { 

		 } 
	}*/

	@SuppressWarnings("deprecation")
	private void saveData(String cclass, String[] datainfo) {
		StringBuffer querySQL = new StringBuffer("");
		StringBuffer insertSQL = new StringBuffer("");
		// Constant.TMP_TRADEDATE = datainfo[12] + " " + datainfo[6];
		/*
		 * querySQL.append(
		 * "select count(1) from noblemetal where class =? and tradedate = ?");
		 * if (jdbcTemplate.queryForInt(querySQL.toString(), new Object[] {
		 * cclass, datainfo[12] + " " + datainfo[6] }) > 0) { return; }
		 */
		insertSQL
				.append(" insert into noblemetal (class,tradedate,changerate,price,buy,sell,maxprice,minprice,yestodayprice,openprice,amount,buyamount,sellamount)");
		insertSQL.append(" values(?,?,?,?,?,?,?,?,?,?,?,?,?)");
		try {
			jdbcTemplate.update(insertSQL.toString(), new Object[] { cclass, datainfo[12] + " " + datainfo[6],
					datainfo[1], datainfo[0], datainfo[2], datainfo[3], datainfo[4], datainfo[5], datainfo[7],
					datainfo[8], datainfo[9], datainfo[10], datainfo[11] });
		} catch (DataAccessException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

}
