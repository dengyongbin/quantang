package com.quantang.dao.impl;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.dao.DataAccessException;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

import com.quantang.common.Constant;
import com.quantang.dao.CaptureDao;

@Repository
public class CaptureDaoImpl implements CaptureDao {
	@Autowired
	private JdbcTemplate jdbcTemplate;

	@Override
	public void saveNobleMetalData(String datas) {
		if ("".equals(datas) || datas == null) {
			return;
		}
		String data[] = datas.split(";");
		for (int i = 0; i < data.length; i++) {
			String[] datainfo = data[i].split("\"")[1].split(",");

			if (data[i].contains(Constant.CAPTURE_CALSS[i])) {
				if (!"".equals(Constant.TMP_TRADEDATE[i]) && datainfo[6].equals(Constant.TMP_TRADEDATE[i])) {
					Constant.TMP_TRADEDATE[i] = datainfo[6];
					break;
				}
				saveData(Constant.CAPTURE_CALSS[i], datainfo);
				Constant.TMP_TRADEDATE[i] = datainfo[6];
			}
		}
	}

	private void saveData(String cclass, String[] datainfo) {
		StringBuffer insertSQL = new StringBuffer("");
		insertSQL
				.append(" insert into noblemetal (class,tradedate,changerate,price,buy,sell,maxprice,minprice,yestodayprice,openprice,amount,buyamount,sellamount)");
		insertSQL.append(" values(?,?,?,?,?,?,?,?,?,?,?,?,?)");
		try {
			jdbcTemplate.update(insertSQL.toString(), new Object[] { cclass, datainfo[12] + " " + datainfo[6],
					datainfo[1], datainfo[0], datainfo[2], datainfo[3], datainfo[4], datainfo[5], datainfo[7],
					datainfo[8], datainfo[9], datainfo[10], datainfo[11] });
		} catch (DataAccessException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

}
